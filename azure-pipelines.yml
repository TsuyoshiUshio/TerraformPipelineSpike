# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- none
pr:
- master

pool:
  vmImage: 'ubuntu-latest'

steps:
- task: RunPipelines@1
  displayName: Terraform Apply (Master Branch)
  inputs:
    serviceConnection: 'Run Pipeline Service Connection'
    project: 'syncier test'
    folderPath: '\'
    buildDefinition: 'TsuyoshiUshio.TerrformApply.CI'
    setBranch: true
    Branch: 'refs/heads/master'
    targetType: 'inline'
    buildParameters: '[{"hello":"world"}]'
    customPrefix: 'Run'
    waitForQueuedBuildsToFinish: true
    waitRefreshTime: '10'
    waitTimeOut: '120'
    storeInOutputVariable: false

- task: RunPipelines@1
  displayName: Terraform Apply ($(Build.SourceBranch))
  condition: succeededOrFailed()
  inputs:
    serviceConnection: 'Run Pipeline Service Connection'
    project: 'syncier test'
    folderPath: '\'
    buildDefinition: 'TsuyoshiUshio.TerrformApply.CI'
    setBranch: true
    Branch: '$(Build.SourceBranch)'
    targetType: 'inline'
    buildParameters: '[{"hello":"world"}]'
    customPrefix: 'Run'
    waitForQueuedBuildsToFinish: true
    waitRefreshTime: '10'
    waitTimeOut: '120'
    storeInOutputVariable: false
